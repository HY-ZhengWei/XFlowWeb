<!DOCTYPE html>
<html>
<head>

	<title>工作流</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	
	<script type="text/javascript" charset="utf-8" src="../../d3/d3.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="../../d3/hy.common.d3.js"></script>
	<script type="text/javascript" charset="utf-8" src="../../jquery/jquery.min.js" ></script>
	<script type="text/javascript" charset="utf-8" src="../../jquery/jquery-ui.min.js"></script>
	
	<link rel="stylesheet" href="../../jquery/jquery-ui.min.css" />
	
	<style type="text/css">
	body {
	  font-family: 'Open Sans', sans-serif;
	  font-size: 12px;
	  font-weight: 400;
	  background-color: #fff;
	}
	</style>
	
</head>
<body>

	<svg width="100%" height="900" version="1.1" xmlns="http://www.w3.org/2000/svg">
	

	</svg>
	
	<script type="text/javascript">
	
	function menuOnClick(d ,i)
	{
		console.log("菜单 " + d.name + " 被点击");
	}
	
	
	
	
	var v_SVG        = d3.select("svg").style("background" ,"LightSteelBlue");
	var v_Menus      = [{bgColor:"#E45D5C"    ,bgColorMouse:"#E87372" ,bgColorClick:"#FF974D" ,fontColor:"white" ,fontColorMouse:"white" ,fontSize:18 ,onClick:menuOnClick ,name:"编辑"} 
	                   ,{bgColor:"ghostwhite" ,bgColorMouse:"#E87372" ,bgColorClick:"#FF974D" ,fontColor:"black" ,fontColorMouse:"white" ,fontSize:14 ,onClick:menuOnClick ,name:"活动颜色"} 
	                   ,{bgColor:"ghostwhite" ,bgColorMouse:"#E87372" ,bgColorClick:"#FF974D" ,fontColor:"black" ,fontColorMouse:"white" ,fontSize:14 ,onClick:menuOnClick ,name:"文字颜色"} 
	                   ,{bgColor:"ghostwhite" ,bgColorMouse:"#E87372" ,bgColorClick:"#FF974D" ,fontColor:"black" ,fontColorMouse:"white" ,fontSize:14 ,onClick:menuOnClick ,name:"页签颜色"} 
	                   ,{bgColor:"ghostwhite" ,bgColorMouse:"#E87372" ,bgColorClick:"#FF974D" ,fontColor:"black" ,fontColorMouse:"white" ,fontSize:14 ,onClick:menuOnClick ,name:"边框颜色"}];
	var v_MenuMargin = [1 ,2.2 ,2.2 ,2 ,1.7 ,1.5 ,1.3 ,1.2 ,1.1]; 
	
	
	createSmartContextMenu(v_SVG ,35 ,v_Menus);
	
	
	
	/**
	 * 计算背景最大圆的半径
	 *
	 * @author      ZhengWei(HY)
	 * @createDate  2019-08-30
	 * @version     v1.0
	 *
	 * @param i_MenuItemSize   菜单项的大小。一般为圆的半径。
	 * @param i_MenuSize       按顺时针环绕菜单项的数量。
	 */
	function calcSuperRadius(i_MenuItemSize ,i_MenuSize)
	{
		if ( i_MenuSize == 1 )
		{
			return i_MenuItemSize * v_MenuMargin[i_MenuSize];
		}
		
		var v_Angle     = 360 / i_MenuSize;
		var v_HalfAngle = v_Angle / 2; 
		var v_X         = 2 * Math.PI / 360 * v_HalfAngle;
		var v_SinX      = Math.sin(v_X);
		var v_Margin    = i_MenuSize > v_MenuMargin.length - 1 ? v_MenuMargin[v_MenuMargin.length - 1] : v_MenuMargin[i_MenuSize];
		
		return (i_MenuItemSize * v_Margin) / v_SinX;
	}
	
	
	
	/**
	 * 创建聪明的右击菜单
	 *
	 * @author      ZhengWei(HY)
	 * @createDate  2019-08-30
	 * @version     v1.0
	 *
	 * @param i_Stage          绘制右击菜单的舞台。可以是SVG，G等元素       
	 * @param i_MenuItemSize   菜单项的大小。一般为圆的半径。
	 * @param i_Menus          菜单数据，为数组类型，格式如下
	 *                         i_Menus[i].name            菜单名称
	 *                         i_Menus[i].bgColor         菜单背景色
	 *                         i_Menus[i].bgColorMouse    菜单背景色，鼠标放在上面时
	 *                         i_Menus[i].bgColorClick    菜单背景色，鼠标点击时
	 *                         i_Menus[i].fontSize        菜单文字大小
	 *                         i_Menus[i].fontColor       菜单文字颜色
	 *                         i_Menus[i].fontColorMouse  菜单文字颜色，鼠标放在上面时
	 *                         i_Menus[i].onClick         菜单被点击后执行方法的引用
	 *                         首元素为最中间的菜单，之后的元素按顺时针环绕。
	 */
	function createSmartContextMenu(i_Super ,i_MenuItemSize ,i_Menus)
	{
		var v_SuperRadius  = calcSuperRadius(i_MenuItemSize ,i_Menus.length - 1);   /* 背景圆的半径 */
		var v_SuperPadding = 30; 
		var v_SuperCX      = v_SuperRadius + i_MenuItemSize / 3 + v_SuperPadding;   /* 所有圆的中心点 */
		var v_SuperCY      = v_SuperRadius + i_MenuItemSize / 3 + v_SuperPadding;   /* 所有圆的中心点 */
		var v_OffsetAngle  = (360 / (i_Menus.length - 1)) * -1 - 90;
		
		
		/* 背景最大的圆 */
		i_Super.append("circle")
		.attr("cx" ,v_SuperCX)
		.attr("cy" ,v_SuperCY)
		.attr("r"  ,v_SuperRadius + i_MenuItemSize / 3)
		.attr("fill" ,"none")
		.attr("stroke-width" ,i_MenuItemSize / 4 * 3)
		.attr("stroke" ,"gray")
		.attr("opacity" ,0.5);
		
		
		/* 绘制菜单项的圆 */
		i_Super.selectAll(".SmartMenuItem").data(i_Menus).enter()
		.append("circle")
		.attr("id" ,function(d ,i)
		{
			return 	"SmartMenuItem_" + i;
		})
		.attr("class" ,"SmartMenuItem")
		.attr("cx" ,function(d ,i)
		{
			if ( i == 0 )
			{
				d.x = v_SuperCX;
			}
			else if ( i == 1 && i_Menus.length - 1 == 1 )
			{
				d.x = calcCirclePointX(v_SuperCX ,v_SuperRadius ,-90);
			}
			else
			{
				d.x = calcCirclePointX(v_SuperCX ,v_SuperRadius ,360 / (i_Menus.length - 1) * i + v_OffsetAngle);
			}
			
			return d.x;
		})
		.attr("cy" ,function(d ,i)
		{
			if ( i == 0 )
			{
				d.y = v_SuperCY; 
			}
			else if ( i == 1 && i_Menus.length - 1 == 1 )
			{
				d.y = calcCirclePointY(v_SuperCY ,v_SuperRadius ,-90);
			}
			else 
			{
				d.y = calcCirclePointY(v_SuperCY ,v_SuperRadius ,360 / (i_Menus.length - 1) * i + v_OffsetAngle);
			}
			
			return d.y;
		})
		.attr("r"  ,i_MenuItemSize)
		.attr("fill" ,function(d ,i)
		{
			return d.bgColor;
		})
		.on("mouseover" ,function(d ,i)
		{
			i_Super.select("#SmartMenuItem_"     + i).attr("fill" ,d.bgColorMouse);
			i_Super.select("#SmartMenuItemName_" + i).attr("fill" ,d.fontColorMouse);
		})
		.on("mouseout" ,function(d ,i)
		{
			i_Super.select("#SmartMenuItem_"     + i).attr("fill" ,d.bgColor);
			i_Super.select("#SmartMenuItemName_" + i).attr("fill" ,d.fontColor);
		})
		.on("click" ,function(d ,i)
		{
			i_Super.select("#SmartMenuItem_"     + i).attr("fill" ,d.bgColorClick);
			if ( d.onClick )
			{
				d.onClick.call(this ,d ,i);
			}
		});
		
		
		/* 绘制菜单项的名称 */
		i_Super.selectAll(".SmartMenuItemName").data(i_Menus).enter()
		.append("text")
		.attr("id" ,function(d ,i)
		{
			return 	"SmartMenuItemName_" + i;
		})
		.attr("class" ,"SmartMenuItemName")
		.attr("x" ,function(d ,i)
		{
			return d.x;
		})
		.attr("y" ,function(d ,i)
		{
			return d.y;
		})
		.attr("dx" ,function(d ,i)
		{
			return d.fontSize * d.name.length / 2 * -1;	
		})
		.attr("dy" ,function(d ,i)
		{
			return d.fontSize / 5 * 2;	
		})
		.attr("fill" ,function(d ,i)
		{
			return d.fontColor;	
		})
		.attr("font-size" ,function(d ,i)
		{
			return d.fontSize;	
		})
		.text(function(d ,i)
		{
			return d.name;
		})
		.on("mouseover" ,function(d ,i)
		{
			i_Super.select("#SmartMenuItem_"     + i).attr("fill" ,d.bgColorMouse);
			i_Super.select("#SmartMenuItemName_" + i).attr("fill" ,d.fontColorMouse);
		})
		.on("mouseout" ,function(d ,i)
		{
			i_Super.select("#SmartMenuItem_"     + i).attr("fill" ,d.bgColor);
			i_Super.select("#SmartMenuItemName_" + i).attr("fill" ,d.fontColor);
		})
		.on("click" ,function(d ,i)
		{
			i_Super.select("#SmartMenuItem_"     + i).attr("fill" ,d.bgColorClick);
			if ( d.onClick )
			{
				d.onClick.call(this ,d ,i);
			}
		});
	}
	
	
	
	
	
	</script>
	
</body>
</html>